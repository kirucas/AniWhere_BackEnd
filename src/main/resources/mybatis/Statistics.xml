<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mybatis.Statistics">
	
	<insert id="createCountingRow" parameterType="java.util.Map">
		INSERT INTO member_visit_count(no, today, year, month, day)
		VALUES(seq_visit.nextval, #{today}, TO_NUMBER(TO_CHAR(#{today}, 'YYYY')),TO_NUMBER(TO_CHAR(#{today}, 'MM')),TO_NUMBER(TO_CHAR(#{today}, 'DD')))
	</insert>
	
	<select id="todayVisitCount" parameterType="java.util.Map" resultType="int">
		SELECT SUM(visit_count)
		FROM member_visit_count
		WHERE TO_CHAR(today)=TO_CHAR(#{today})
	</select>
	
	<select id="todayAllBoardCount" parameterType="java.util.Map" resultType="int">
		SELECT (
			(SELECT COUNT(*) FROM photo WHERE TO_CHAR(photo_regidate)=TO_CHAR(#{today})) +
			(SELECT COUNT(*) FROM movie WHERE TO_CHAR(movie_regidate)=TO_CHAR(#{today})) +
			(SELECT COUNT(*) FROM tip WHERE TO_CHAR(tip_regidate)=TO_CHAR(#{today})) +
			(SELECT COUNT(*) FROM quest WHERE TO_CHAR(quest_regidate)=TO_CHAR(#{today})) +
			(SELECT COUNT(*) FROM freeboard WHERE TO_CHAR(free_regidate)=TO_CHAR(#{today})) +
			(SELECT COUNT(*) FROM market_buy WHERE TO_CHAR(regidate)=TO_CHAR(#{today})) +
			(SELECT COUNT(*) FROM market_sell WHERE TO_CHAR(regidate)=TO_CHAR(#{today})) +
			(SELECT COUNT(*) FROM market_group_buy WHERE TO_CHAR(regidate)=TO_CHAR(#{today})) +
			(SELECT COUNT(*) FROM miss_see WHERE TO_CHAR(regidate)=TO_CHAR(#{today})) +
			(SELECT COUNT(*) FROM miss_find WHERE TO_CHAR(regidate)=TO_CHAR(#{today}))
			)
		FROM dual
	</select>
	
	<select id="allMemberCount" resultType="int">
		SELECT COUNT(*)
		FROM member
	</select>
	
	<select id="allVisitor" resultType="int">
		SELECT SUM(visit_count)
		FROM member_visit_count
	</select>
	
	<select id="allLostAnimal" resultType="int">
		SELECT COUNT(*)
		FROM lost_animal
	</select>
	
	<select id="allBoardCount" resultType="int">
		SELECT (
			(SELECT COUNT(*) FROM photo) +
			(SELECT COUNT(*) FROM movie) +
			(SELECT COUNT(*) FROM tip) +
			(SELECT COUNT(*) FROM quest) +
			(SELECT COUNT(*) FROM freeboard) +
			(SELECT COUNT(*) FROM market_buy) +
			(SELECT COUNT(*) FROM market_sell) +
			(SELECT COUNT(*) FROM market_group_buy) +
			(SELECT COUNT(*) FROM miss_see) +
			(SELECT COUNT(*) FROM miss_find)
			)
		FROM dual
	</select>
	
	<select id="allVisitCount" resultType="java.util.Map">
		SELECT month, SUM(visit_count) sum
		FROM member_visit_count
		GROUP BY month
		ORDER BY month
	</select>
	
	<select id="allBoardRegiCount" resultType="java.util.Map">
		SELECT regidate, SUM(count) sum
		FROM (
			SELECT *
			FROM (
				SELECT TO_CHAR(photo_regidate, 'MM') regidate, count(*) count
				FROM photo
				GROUP BY TO_CHAR(photo_regidate, 'MM')
				ORDER BY TO_CHAR(photo_regidate, 'MM')
				)
			UNION
			SELECT *
			FROM (
				SELECT TO_CHAR(movie_regidate, 'MM') regidate, count(*) count
				FROM movie
				GROUP BY TO_CHAR(movie_regidate, 'MM')
				ORDER BY TO_CHAR(movie_regidate, 'MM') 
				)
			UNION
			SELECT *
			FROM (
				SELECT TO_CHAR(tip_regidate, 'MM') regidate, count(*) count
				FROM tip
				GROUP BY TO_CHAR(tip_regidate, 'MM')
				ORDER BY TO_CHAR(tip_regidate, 'MM') 
				)
			UNION
			SELECT *
			FROM (
				SELECT TO_CHAR(quest_regidate, 'MM') regidate, count(*) count
				FROM quest
				GROUP BY TO_CHAR(quest_regidate, 'MM')
				ORDER BY TO_CHAR(quest_regidate, 'MM') 
				)
			UNION
			SELECT *
			FROM (
				SELECT TO_CHAR(free_regidate, 'MM') regidate, count(*) count
				FROM freeboard
				GROUP BY TO_CHAR(free_regidate, 'MM')
				ORDER BY TO_CHAR(free_regidate, 'MM') 
				)
			UNION
			SELECT *
			FROM (
				SELECT TO_CHAR(regidate, 'MM') regidate, count(*) count
				FROM market_buy
				GROUP BY TO_CHAR(regidate, 'MM')
				ORDER BY TO_CHAR(regidate, 'MM') 
				)
			UNION
			SELECT *
			FROM (
				SELECT TO_CHAR(regidate, 'MM') regidate, count(*) count
				FROM market_sell
				GROUP BY TO_CHAR(regidate, 'MM')
				ORDER BY TO_CHAR(regidate, 'MM') 
				)
			UNION
			SELECT *
			FROM (
				SELECT TO_CHAR(regidate, 'MM') regidate, count(*) count
				FROM market_group_buy
				GROUP BY TO_CHAR(regidate, 'MM')
				ORDER BY TO_CHAR(regidate, 'MM') 
				)
			UNION
			SELECT *
			FROM (
				SELECT TO_CHAR(regidate, 'MM') regidate, count(*) count
				FROM miss_see
				GROUP BY TO_CHAR(regidate, 'MM')
				ORDER BY TO_CHAR(regidate, 'MM') 
				)
			UNION
			SELECT *
			FROM (
				SELECT TO_CHAR(regidate, 'MM') regidate, count(*) count
				FROM miss_find
				GROUP BY TO_CHAR(regidate, 'MM')
				ORDER BY TO_CHAR(regidate, 'MM') 
				)
			)
		GROUP BY regidate
		ORDER BY regidate
	</select>
	
	<select id="animalCategoryCount" resultType="java.util.Map">
		SELECT category, SUM(count) sum
		FROM (
			SELECT *
			FROM (
				SELECT ani_category category, count(*) count
				FROM photo
				GROUP BY ani_category
				ORDER BY ani_category
				)
			UNION
			SELECT *
			FROM (
				SELECT ani_category category, count(*) count
				FROM movie
				GROUP BY ani_category
				ORDER BY ani_category
				)
			UNION
			SELECT *
			FROM (
				SELECT ani_category category, count(*) count
				FROM tip
				GROUP BY ani_category
				ORDER BY ani_category
				)
			UNION
			SELECT *
			FROM (
				SELECT ani_category category, count(*) count
				FROM quest
				GROUP BY ani_category
				ORDER BY ani_category
				)
			)
		GROUP BY category
		ORDER BY category
	</select>
	
	<select id="allReservationStatis" resultType="java.util.Map">
		SELECT TO_CHAR(apply_date, 'MM') month, COUNT(*) count
		FROM reservation
		GROUP BY TO_CHAR(apply_date, 'MM')
		ORDER BY TO_CHAR(apply_date, 'MM')
	</select>
	
</mapper>